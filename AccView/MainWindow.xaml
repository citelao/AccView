<?xml version="1.0" encoding="utf-8"?>
<winex:WindowEx
    x:Class="AccView.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AccView"
    xmlns:winex="using:WinUIEx"
    xmlns:vm="using:AccView.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Height="480"
    Width="640"
    Title="AccView"
    Closed="WindowEx_Closed">

    <winex:WindowEx.SystemBackdrop>
        <MicaBackdrop />
    </winex:WindowEx.SystemBackdrop>

    <Grid
        Loaded="Grid_Loaded"
        RowSpacing="4"
        ColumnSpacing="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" /> <!-- Main UI -->
            <RowDefinition Height="Auto" /> <!-- Log -->
        </Grid.RowDefinitions>
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" /> <!-- Tree-->
            <ColumnDefinition Width="2*" /> <!-- Details -->
        </Grid.ColumnDefinitions>

        <ScrollViewer x:Name="ElementsScrollViewer">
            <StackPanel>
                <TreeView x:Name="ElementsTreeView"
                          ItemsSource="{x:Bind AccessibilityTree}"
                          Expanding="ElementsTreeView_Expanding"
                          SelectionChanged="ElementsTreeView_SelectionChanged"
                          Margin="4,0,0,0">
                
                    <TreeView.Resources>
                        <ResourceDictionary 
                           Source="ms-appx:///Microsoft.UI.Xaml/DensityStyles/Compact.xaml"/>
                    </TreeView.Resources>
                    <TreeView.ItemTemplate>
                        <DataTemplate x:DataType="vm:AutomationElementViewModel">
                            <TreeViewItem ItemsSource="{x:Bind Children, Mode=OneWay}" PointerEntered="TreeViewItem_PointerEntered">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind LocalizedControlType, Mode=OneWay}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    <TextBlock Text="{x:Bind Name, Mode=OneWay}" />
                                </StackPanel>
                            </TreeViewItem>
                        </DataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>

            </StackPanel>
        </ScrollViewer>

        <StackPanel
            Grid.Row="1"
            Orientation="Horizontal"
            Spacing="4"
            Margin="8,0,0,0">
            <Button x:Name="FromCursor" Click="FromCursor_Click">
                <Button.KeyboardAccelerators>
                    <KeyboardAccelerator Key="C" Modifiers="Control" />
                </Button.KeyboardAccelerators>
                Get from cursor
            </Button>
            <Border
                ToolTipService.ToolTip="Follow pointer focus (not implemented)">
                <ToggleButton
                    Name="FollowPointerFocusButton"
                    ToolTipService.ToolTip="Follow pointer focus"
                    IsChecked="False"
                    IsEnabled="False">
                    <FontIcon Glyph="&#xE8B0;" FontSize="16" />
                </ToggleButton>
            </Border>
            <!-- Buggy :( -->
            <ToggleButton
                Name="FollowKeyboardFocusButton"
                ToolTipService.ToolTip="Follow keyboard focus"
                IsChecked="False"
                Click="FollowKeyboardFocus_Click">
                <FontIcon Glyph="&#xE8AC;" FontSize="16" />
            </ToggleButton>
        </StackPanel>

        <Frame x:Name="ElementDetail"
               Background="{ThemeResource LayerFillColorAltBrush}"
               BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
               BorderThickness="1"
               Padding="8,0"
               CornerRadius="4,0,0,4"
               Grid.Column="1">
        </Frame>

        <Expander
            x:Name="OutputExpander"
            Grid.Row="1"
            Grid.Column="1"
            HorizontalAlignment="Stretch"
            HorizontalContentAlignment="Stretch"
            Margin="0,8,8,8">
            <Expander.Header>Log</Expander.Header>
            <TextBox
                x:Name="OutputTextBlock"
                AcceptsReturn="True"
                VerticalAlignment="Stretch"
                HorizontalAlignment="Stretch" />
        </Expander>
    </Grid>
</winex:WindowEx>
